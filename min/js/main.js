function init(){var o=$("#my_comment_stage");console.log("bullet width = "+o.width()),console.log("bullet width = "+o.width()),console.log("bullet height = "+o.height());$("#my_video");var e=new CommentManager(document.getElementById("my_comment_stage"));e.init(),e.start(),window.cm=e,window.cm_width=o.width(),window.cm_height=o.height(),console.log("cm_width = "+window.cm_width),console.log("cm_height = "+window.cm_height)}function yunba_msg_cb(o){if(o.topic===TOPIC_BULLET)cm.send(JSON.parse(o.msg));else if(o.topic===TOPIC_LIKE){n=parseInt($("#like-number").text())+1;$("#like-number").text(n),show_like_animate()}else if(o.topic===TOPIC_STAT){n=(e=JSON.parse(o.msg)).presence;$("#online-number").text(n)}else if(o.topic===alias){var e=JSON.parse(o.msg),n=parseInt($("#online-number").text())+e.presence;$("#online-number").text(n),n=e.like,$("#like-number").text(n)}}function yunba_sub_ok(){setTimeout(function(){$(".msg_box").css("display","block"),$},1e3)}function show_like_animate(){var o=9*cm_width/10,e=7*cm_height/8;console.log("x = "+o),console.log("y = "+e);var n=TEXTS[Math.floor(Math.random()*TEXTS.length)],t={stime:0,size:32,color:15790320+Math.floor(986895*Math.random()),mode:7,pool:1,position:"absolute",dbid:104079685,hash:"9bd49c01",border:!1,shadow:!1,x:o,y:e,text:n,rZ:0,rY:0,motion:[{x:{from:o,to:o,dur:1500,delay:0},y:{from:e,to:e-cm_height/2,dur:1500,delay:0}}],movable:!0,font:"宋体",dur:1500,opacity:1,alpha:{from:1,to:0}};cm.send(t)}var APPKEY="5951c4af2a9275716fe3b289",TOPIC_BULLET="bullet",TOPIC_LIKE="like",TOPIC_STAT="stat",TEXTS=["♪","♩","♭","♬"],colorSelect={one:"F08080",two:"ADD8E6",three:"FFFF00",four:"FFA07A",five:"90EE90",six:"9370DB",seven:"6BDAEA"},modeSelect={top:1,bottom:2,left:6,right:2},color=parseInt("0xff0000"),mode=2;$(document).ready(function(){$("#span-status").text("正在连接云巴服务器..."),window.onresize=init,init(),window.yunba=new Yunba({server:"sock.yunba.io",port:3e3,appkey:APPKEY}),yunba.init(function(o){if(o){var e=Math.random().toString().substr(2);console.log("cid: "+e),window.alias=e,yunba.connect_by_customid(e,function(o,e,n){o?(console.log("sessionid："+n),yunba.set_message_cb(yunba_msg_cb),yunba.set_alias({alias:alias},function(o){yunba.subscribe({topic:TOPIC_BULLET},function(o,e){o?(console.log("subscribed"),yunba.subscribe({topic:TOPIC_LIKE},function(o,e){o?(console.log("subscribed"),yunba.subscribe({topic:TOPIC_STAT},function(o,e){o?(console.log("subscribed"),yunba_sub_ok()):console.log(e)})):console.log(e)})):console.log(e)})})):console.log(e)})}else console.log("yunba init failed")})}),$("#msg_send_btn").click(function(){console.log("mode = "+mode);var o=$("#msg_input").val(),e={mode:mode,text:o,color:color,dur:3e3};yunba.publish({topic:TOPIC_BULLET,msg:JSON.stringify(e)},function(o,e){o||console.log(e)})}),$("#btn-like").click(function(){yunba.publish({topic:TOPIC_LIKE,msg:"like"},function(o,e){o||console.log(e)})});